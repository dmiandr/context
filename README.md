# CONText
WebExtension for CONT.ws user management

Расширение предназначено для упорядочения общения с пользователями/авторами платформы CONT.ws. Для этого предоставляется возможность заносить любые ***потенциальные события*** (записи и комментарии автора) в его личную историю, сохраняемую локально, в встроенной БД браузера. Сформированное на основании этой истории общее мнение о пользователе можно зафиксировать, присвоив ему соответствующий ***статус*** из списка. В дальнейшем, любое упоминание пользователя будет сопровождаться цветовой маркировкой, соответствующей присвоенному статусу и ссылкой на перечень событий истории пользователя. Все эти функции осуществляются через специальное меню, добавляемое расширением к каждому упоминанию авторов на страницах cont.ws. 

После установки расширения, на всех страницах cont.ws, кроме сервисных, у каждого упоминания любого автора, которое является ссылкой на его профиль, появляется меню. 
Верхний пункт этого меню представляет собой логин пользователя и количество ассоциированных с ним событий (в скобках). Если событий более 0, то этот пункт становится активным, при его выборе открывается список событий данного пользователя.
Если данное упоминание является потенциальным событием, т. е. ***имеет уникальную ссылку и метку времени*** (таковыми являются записи автора и его комментарии), то в меню добавляются дополнительно пункт добавления/редактирования событий, а также перечень доступных для установки статусов:

![вид меню потенциального события](menu_plain.png)

### Добавление события
При выборе пункта меню "Добавить к истории" открывается окно описания события:

![окно описания события - новое событие](addevent.png)

Данные события считываются со страницы. Часть из них не редактируемые - тип события, автор, время, ссылка и т.д. Часть могут быть отредактированы пользователем - заголовок, основной текст, признак репоста. Кнопка "Добавить" сохраняет данные в бд и закрывает окно. После сохранения события, счетчик событий увеличивается на единицу, а имя автора, являющееся ссылкой, связанной с событием, выделяется графически - начинает мигать.

### Редактирование/Удаление события

Если данное упоминание автора уже является событием, то есть уже было добавлено к истории, то имя автора на странице мигает, второй пункт в меню называется "Изменить событие". Он открывает окно описания существующего события:

![окно описания события - существующее событие](editevent.png)

Данные события берутся из базы данных. Кнопка "Изменить" сохраняет отредактированное событие, кнопка "Удалить" удаляет его из базы и закрывает окно.

### Просмотр списка событий

Если данному автору соответствует хотя-бы одно событие, то верхний пункт меню открывает отдельное окно с перечнем событий, соответствующих автору:

![перечень событий автора](hist_window.png)

 В верхней части окна расположен псевдоним и в скобках — логин автора. Ниже — редактируемое поле, в котором можно разместить детальное описание автора - итог всей истории наблюдений. В правом верхнем углу расположены кнопки "Закрыть", закрывающая все окно, "Обновить" обновляющая список в окне и "Сохранить" — кнопка, сохраняющая отредактированное текстовое описание автора. 
 В основной части окна расположена таблица, содержащая список событий. В таблице есть три колонки: Время, Заголовок и Событие. Первая содержит дату и время события. Вторая колонка содержит заголовок события, одновременно являющийся ссылкой, открывающей окно описания события — таким образом уже существующее событие можно отредактировать или удалить. Третья колонка показывает тип события (Комментарий или Запись), которая одновременно является ссылкой на событие, страница открывается в новой вкладке основного окна.

### Экспорт/импорт данных
Осуществляется со страницы настроек расширения. Кнопка "Экспорт" формирует файл с данными пользователя - списком событий, возможных статусов и пользователей с присвоенными статусами - и сохраняет его в выбранную директорию в формате json. Если вместо предложения сохранить файл открывается JsonViewer, то следует воспользоваться расположенной рядом ссылкой, осуществляющей экспорт в более ранних версиях FireFox.
Импорт загружает файл с данными, при установке опции "очистить бд перед загрузкой" - удаляет все имеющиеся в БД данные, в противном случае - добавляет загружаемые события к уже имеющимся.

### Полный список событий
В нижней части страницы настроек расположен полный список всех авторов, которым были назначены события. Первая колонка содержит логин автора, она же является ссылкой, открывающей список событий этого конкретного автора. Вторая колонка - псевдоним автора, раскрашенный в соответствии с назначенным статусом. Последняя - общее количество событий у данного автора.

Подробности, текущие объявления и обсуждения ведутся в блоге https://cont.ws/@dmitrevo

Благодарю авторов следующих библиотек, задействованных в расширении/Acknowledgments to authors of the following libraries, used in extension:
* https://github.com/mozilla/webextension-polyfill
* https://github.com/eligrey/FileSaver.js

